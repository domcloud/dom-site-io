"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[25],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=o.createContext({}),s=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=s(e.components);return o.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(t),m=r,f=d["".concat(p,".").concat(m)]||d[m]||c[m]||i;return t?o.createElement(f,a(a({ref:n},u),{},{components:t})):o.createElement(f,a({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=d;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var s=2;s<i;s++)a[s]=t[s];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6550:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var o=t(7462),r=(t(7294),t(3905));const i={layout:"docs"},a="Deploying your Software",l={unversionedId:"deploy",id:"deploy",title:"Deploying your Software",description:"Here's the place you need to read for hands-on tutorial for deploying any software. You should also read this in accordance with the Runner Script and Troubleshoot in case you hit into problem later.",source:"@site/docs/deploy.md",sourceDirName:".",slug:"/deploy",permalink:"/docs/deploy",draft:!1,editUrl:"https://github.com/domcloud/domcloud-co/tree/master/docs/deploy.md",tags:[],version:"current",frontMatter:{layout:"docs"},sidebar:"tutorialSidebar",previous:{title:"cname",permalink:"/docs/cname"},next:{title:"php",permalink:"/docs/deploying/php"}},p={},s=[{value:"Preliminary Setup",id:"preliminary-setup",level:2},{value:"The Runner Script or Template",id:"the-runner-script-or-template",level:3},{value:"Cloning from Git Repo",id:"cloning-from-git-repo",level:3},{value:"Features to Use",id:"features-to-use",level:3},{value:"Are you deploying for main domain or subdomain?",id:"are-you-deploying-for-main-domain-or-subdomain",level:3},{value:"Specific Deployment setup for PHP",id:"specific-deployment-setup-for-php",level:2},{value:"Selecting PHP Version",id:"selecting-php-version",level:3},{value:"Configuring for Root Folder",id:"configuring-for-root-folder",level:3},{value:"Composer Install",id:"composer-install",level:3},{value:"Index.php Redirection",id:"indexphp-redirection",level:3},{value:"Subfolder Aliasing",id:"subfolder-aliasing",level:3},{value:"<code>user.ini</code> Configuration",id:"userini-configuration",level:3},{value:"Denying Hidden Files",id:"denying-hidden-files",level:3},{value:"Specific Deployment setup for Node.js",id:"specific-deployment-setup-for-nodejs",level:2},{value:"Specific Deployment setup for Python",id:"specific-deployment-setup-for-python",level:2},{value:"Specific Deployment setup for Ruby",id:"specific-deployment-setup-for-ruby",level:2},{value:"Specific Deployment setup for Everything Else",id:"specific-deployment-setup-for-everything-else",level:2}],u={toc:s};function c(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deploying-your-software"},"Deploying your Software"),(0,r.kt)("p",null,"Here's the place you need to read for hands-on tutorial for deploying any software. You should also read this in accordance with the ",(0,r.kt)("a",{parentName:"p",href:"/docs/runner"},"Runner Script")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/troubleshoot"},"Troubleshoot")," in case you hit into problem later."),(0,r.kt)("h2",{id:"preliminary-setup"},"Preliminary Setup"),(0,r.kt)("h3",{id:"the-runner-script-or-template"},"The Runner Script or Template"),(0,r.kt)("p",null,"When you create a new host, you will prompted with ",(0,r.kt)("strong",{parentName:"p"},"Template")," text box. That is the script that will be executed on the host. We use YAML format here, which defined on the ",(0,r.kt)("a",{parentName:"p",href:"/docs/runner"},"Runner Script")," page."),(0,r.kt)("p",null,"Remember we also provide a template repository for common templates. If you can't find what you're looking for, you can create your own template by reading below and much better, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/domcloud/domcloud-io/discussions/categories/show-and-tell"},"share it with us"),"."),(0,r.kt)("h3",{id:"cloning-from-git-repo"},"Cloning from Git Repo"),(0,r.kt)("p",null,"If you have a Git repository, you can clone it with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"source: https://github.com/your/repo\n")),(0,r.kt)("p",null,"If your repository is private, or need to be able to push from server, you need to provide your username and password (for GitHub you need to create a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"Personal Token")," because plain password is no longer works)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"source: https://myuser:ghp_token@github.com/your/repo\n")),(0,r.kt)("h3",{id:"features-to-use"},"Features to Use"),(0,r.kt)("p",null,"The second thing you need to configure is the features to use. The features are defined on the ",(0,r.kt)("a",{parentName:"p",href:"/docs/runner#features"},"Features on Runner Script")," page. Commonly you need to use ",(0,r.kt)("inlineCode",{parentName:"p"},"mysql")," (or ",(0,r.kt)("inlineCode",{parentName:"p"},"postgres")," or no at all)  for the database and ",(0,r.kt)("inlineCode",{parentName:"p"},"ssl")," to get SSL certs in order to enable HTTPS."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"features: [mysql, ssl]\n")),(0,r.kt)("h3",{id:"are-you-deploying-for-main-domain-or-subdomain"},"Are you deploying for main domain or subdomain?"),(0,r.kt)("p",null,"If you are deploying for subdomain, you have to specify the subdomain name in the ",(0,r.kt)("inlineCode",{parentName:"p"},"subdomain")," field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"# ... other configs ...\nsubdomain: mysubdomain.mydomain.com\n")),(0,r.kt)("h2",{id:"specific-deployment-setup-for-php"},"Specific Deployment setup for PHP"),(0,r.kt)("h3",{id:"selecting-php-version"},"Selecting PHP Version"),(0,r.kt)("p",null,"To switch PHP version, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"php")," feature. By default we're using ",(0,r.kt)("inlineCode",{parentName:"p"},"7.4")," but you can change it to ",(0,r.kt)("inlineCode",{parentName:"p"},"8.0"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"8.1")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"5.6")," if you need to. Unfortunately you can't ask any other version than the ones listed because PHP installation is always requires system-wide installation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"features:\n- php 8.0\n")),(0,r.kt)("h3",{id:"configuring-for-root-folder"},"Configuring for Root Folder"),(0,r.kt)("p",null,"All sources will be placed under the ",(0,r.kt)("inlineCode",{parentName:"p"},"public_html")," folder. Depending on framework you're using (e.g. Laravel or CodeIgniter 4), you might need to change the root folder to ",(0,r.kt)("inlineCode",{parentName:"p"},"public")," inside it, so your PHP files don't get leaked."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"root: public_html/public\n")),(0,r.kt)("h3",{id:"composer-install"},"Composer Install"),(0,r.kt)("p",null,"Many frameworks (e.g. Laravel) require you to install Composer dependencies. You can call ",(0,r.kt)("inlineCode",{parentName:"p"},"composer")," to install Composer dependencies."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"commands:\n- composer install --no-dev --no-cache --optimize-autoloader\n")),(0,r.kt)("p",null,"The additional options is recommended to save space and gain performance on the host."),(0,r.kt)("h3",{id:"indexphp-redirection"},"Index.php Redirection"),(0,r.kt)("p",null,"Many frameworks also require you to put everything under a single ",(0,r.kt)("inlineCode",{parentName:"p"},"index.php")," file so they can handle a custom error message or some dynamic URL. You can setup NginX configuration to do that:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"nginx:\n  fastcgi: on # Enable PHP processing (you need this)\n  locations:\n  - match: /\n    try_files: $uri $uri/ /index.php?$args\n")),(0,r.kt)("h3",{id:"subfolder-aliasing"},"Subfolder Aliasing"),(0,r.kt)("p",null,"If you happen to have a subfolder inside your source folder, you can alias it to a different name or root path. This allows you to have multiple website and still have a single host URL."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'root: public_html/public # You should never leave this as `public_html` or subfolders will leaked\nnginx:\n  fastcgi: off # disable PHP processing on root\n  locations:\n  - match: /alpha/\n    alias: public_html/alpha/public\n    try_files: $uri $uri/ @alpha\n    fastcgi: on  # enable PHP processing for this\n  - match: "@alpha"\n    rewrite: /alpha/(.*)$ /alpha/index.php?/$1 last\n')),(0,r.kt)("h3",{id:"userini-configuration"},(0,r.kt)("inlineCode",{parentName:"h3"},"user.ini")," Configuration"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"user.ini")," file is a configuration file for PHP. You can use it to configure PHP settings like maximum upload file or maximum timeout limit. To customize this file, you can create ",(0,r.kt)("inlineCode",{parentName:"p"},".user.ini")," file in root folder of your source (which by default is ",(0,r.kt)("inlineCode",{parentName:"p"},"~/public_html/.user.ini"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"commands:\n- rm -f .user.ini\n- echo 'upload_max_filesize = 10M' > .user.ini\n")),(0,r.kt)("h3",{id:"denying-hidden-files"},"Denying Hidden Files"),(0,r.kt)("p",null,"Often times when using non-standard frameworks where you're not isolating the root folder in ",(0,r.kt)("inlineCode",{parentName:"p"},"public")," directory, you might want to deny hidden files because you don't want to expose sensitive information (like ",(0,r.kt)("inlineCode",{parentName:"p"},".git")," or ",(0,r.kt)("inlineCode",{parentName:"p"},".user.ini")," or even ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," files). You can do that by adding ",(0,r.kt)("inlineCode",{parentName:"p"},"deny")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"nginx")," locations section."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"nginx:\n  fastcgi: on\n  locations:\n  - match: ~ /\\.(?!well-known).*\n    deny: all\n")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},".well-known")," must not be blocked because it's used by some services like verificating SSL certificates."),(0,r.kt)("h2",{id:"specific-deployment-setup-for-nodejs"},"Specific Deployment setup for Node.js"),(0,r.kt)("h2",{id:"specific-deployment-setup-for-python"},"Specific Deployment setup for Python"),(0,r.kt)("p",null,"TODO"),(0,r.kt)("h2",{id:"specific-deployment-setup-for-ruby"},"Specific Deployment setup for Ruby"),(0,r.kt)("p",null,"TODO"),(0,r.kt)("h2",{id:"specific-deployment-setup-for-everything-else"},"Specific Deployment setup for Everything Else"),(0,r.kt)("p",null,"TODO"))}c.isMDXComponent=!0}}]);